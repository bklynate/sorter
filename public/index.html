<!DOCTYPE html>
<html>

  <head>
    <title>Sorter: organize ideas and tasks easily</title>
    
    <script src="lib/login.service.js"></script>
    <script src="lib/drive.service.js"></script>    
    <script data-require="jquery@*" data-semver="3.0.0" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.js"></script>
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    <script src="main.js"></script>
    <link rel="stylesheet" href="simplex.bootstrap.min.css">    
    <link rel="stylesheet" href="style.css">    
  </head>

  <body>
    
    <div class="not_authenticated">
      <p>Please sign-in with your Google account to continue.</p>
      <button onclick="login()">Sign-in</button>
    </div>
      
    <div id="container" class="container authenticated">
      <div id="container-header">
        <h1>Sorter</h1>
      </div>
      <div class="row">
        <div id="menu" class="col-sm-2 menu">
          <nav class="nav-sidebar">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Tags</h3>
              </div>
              <div class="panel-body">
                <a class="filter_clear"  href="#">Clear</a><br/>

                <a class="bookmark_link" href="#">#read_later</a> <br/>
                <a class="bookmark_link" href="#">#bookmark</a><br/>
                <a class="bookmark_link" href="#">#tip</a><br/>
                <a class="bookmark_link" href="#">#action</a><br/>
                <a class="bookmark_link" href="#">#goal</a><br/>
              </div>

              <div class="panel-heading">
                <h3 class="panel-title">All tags</h3>
              </div>
              <div id="allTags" class="panel-body">
              </div>

              <div class="panel-heading">
                <h3 class="panel-title">Views</h3>
              </div>
              <div class="panel-body">
                <ul class="nav">
                    <li class="active"><a href="javascript:;">Home Visual</a></li>
                    <li><a href="javascript:;">Raw</a></li>
                    <li class="nav-divider"></li>
                    <li><a href="javascript:;">Journal</a></li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
        <div id="main" class="col-sm-10 main">
          <div class="search_bar form-group">
            <input id="filter_box" type="text" class="form-control" placeholder="filter by tag" oninput="app.filter()">
          </div>
          <div id="main_notes">
            <textarea id="editor"></textarea>
          </div>
        </div>
      </div>
      <div id="fileFinder" class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">FileFinder</h3>
        </div>
        <div class="panel-body">
          <ol></ol>
        </div>        
      </div>
    </div>
    
    <script>
    
      var SCOPES = ['https://www.googleapis.com/auth/drive.file']
      var CLIENT_ID = '';
      window.loginService = new LoginService(CLIENT_ID, SCOPES);
      window.driveService = new DriveService();

      //load the app, api , utils
      app = new App();
      util = new Util();   
      app.init()     

      function init_gapi() {
        gapi.client.load('drive' , 'v3');
        auth();
      } 
      
      function auth() {
        if (gapi && gapi.auth) {
          window.loginService.checkAuth(function(err, response){
            if (err){
              console.log('show login dialog')
              not_auth();
            } else {
              console.log('is logged in')
              is_auth();
              app.listNotes() //todo move this to a better place.
            }
          })
        } else {
          setTimeout(auth, 10); //just in case the gapi lib is not loaded, we call it again
        }
      }
      
      function login() {
        loginService.login(function(err, response){
          if (err){
            console.log('Login error')
            not_auth();
          } else {
            console.log('Login ok')
            is_auth();
          }
        })
      }                 
      //Just jquery stuff to hide, show divs
      $( document ).ready(function() {
        $('.not_authenticated').hide();
        $('.authenticated').hide();
      });

      function is_auth() {
        $('.not_authenticated').hide();
        $('.authenticated').show();
      }

      function not_auth() {
        $('.not_authenticated').show();
        $('.authenticated').hide();
      }       
    </script>
    <script src="https://apis.google.com/js/client.js?onload=init_gapi"></script>
  </body>
</html>
